<!DOCTYPE html>
<html lang="en">
<head>
    <title>Document Signing Dashboard - {{productname}}</title>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <!-- Use the same font stack as the admin dashboard -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto:wght@400;500&family=Manrope:wght@400;600;700&family=Space+Grotesk:wght@600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            /* align with admin design tokens */
            --bg-color: #0a0f1c;
            --panel-bg: rgba(18,26,44,0.88);
            --card-bg-color: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            --surface: rgba(255,255,255,0.03);
            --border-color: rgba(255,255,255,0.06);
            --text-color-primary: #e6edf3;
            --text-color-secondary: rgba(230,237,243,0.65);
            --link-color: #9ecbff;
            --accent-1: #2f7bff;
            --accent-2: #57c2ff;
            --btn-gradient: linear-gradient(140deg, var(--accent-1), var(--accent-2));
            --shadow-color: rgba(2,6,16,0.6);
            --danger-color: #f28b82;
            --hover-bg-color: rgba(255,255,255,0.05);
        }

        body.light-mode {
            --bg-color: #f8f9fa;
            --panel-bg: #ffffff;
            --border-color: rgba(18,38,63,0.08);
            --text-color-primary: #0b1220;
            --text-color-secondary: rgba(11,18,32,0.65);
            --link-color: #1a4aa3;
            --accent-1: #2f7bff;
            --accent-2: #57c2ff;
            --btn-gradient: linear-gradient(140deg, var(--accent-1), var(--accent-2));
            --shadow-color: rgba(16,24,40,0.06);
            --danger-color: #d93025;
            --hover-bg-color: rgba(0,0,0,0.04);
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Manrope', 'Roboto', sans-serif;
            background: var(--bg-color);
            color: var(--text-color-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
            font-size: 14px;
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
        }

        .dashboard-container { padding: 2rem; }
        .headings { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:1.5rem; margin-bottom:1.5rem; }
        .logo-title { display:flex; align-items:center; gap:1rem; }
        .logo { width:40px; height:40px; display:block; }
        .title-group h1 { font-family: 'Space Grotesk', sans-serif; font-size:22px; font-weight:700; margin:0; color:var(--text-color-primary); }
        .title-group h2 { font-family: 'Manrope', sans-serif; font-size:13px; color:var(--text-color-secondary); margin:0; }

        .header-actions { display:flex; align-items:center; gap:1rem; }

        .tab { border-bottom:1px solid var(--border-color); margin-bottom:1rem; overflow-x:auto; }
        .tab button { background:none; border:none; color:var(--text-color-secondary); padding:0.9rem 0.6rem; margin:0 0.6rem; cursor:pointer; font-family:'Google Sans',sans-serif; font-size:15px; border-bottom:3px solid transparent; }
        .tab button:hover { color:var(--text-color-primary); }
        .tab button.active { color:var(--link-color); border-bottom-color:var(--link-color); }

        .tabcontent { display:none; }
        .tabcontent.active { display:block; }
        .tabcontent h2 { font-family:'Google Sans',sans-serif; font-size:18px; font-weight:600; color:var(--text-color-primary); margin-bottom:1rem }

        .table-container { width: 100%; overflow-x:auto; border-radius:8px; border:1px solid var(--border-color); background:var(--panel-bg); }
        table { width:100%; border-collapse:collapse; }
        th, td { padding:12px 14px; text-align:left; border-bottom:1px solid var(--border-color); color:var(--text-color-primary); }
        thead { background: var(--surface); }
        th { color:var(--text-color-secondary); font-weight:600; font-size:12px; text-transform:uppercase; letter-spacing:0.6px; }
        tbody tr:hover { background: var(--hover-bg-color); }

        .btn { display:inline-flex; align-items:center; gap:0.5rem; padding:9px 12px; border-radius:10px; font-weight:600; cursor:pointer; font-family:'Google Sans',sans-serif; font-size:14px; border:1px solid var(--border-color); background:transparent; color:var(--text-color-primary); }
        .btn:hover { background: var(--btn-gradient); color: #fff; box-shadow: 0 12px 40px rgba(36,70,255,0.12); transform: translateY(-2px); }

        .btn-danger { background: transparent; color: var(--danger-color); border: 1px solid var(--danger-color); }

        .floating-btn { position: fixed; bottom: 20px; right: 20px; width: 56px; height: 56px; background: var(--btn-gradient); color: #fff; border: none; border-radius: 50%; font-size: 24px; cursor: pointer; box-shadow: 0 12px 30px rgba(47,123,255,0.12); display: grid; place-items: center; }

        #theme-toggle { width:40px; height:40px; border-radius:50%; display:grid; place-items:center; border:1px solid var(--border-color); background:var(--panel-bg); cursor:pointer; transition: background 0.18s ease, box-shadow 0.18s ease, transform 0.12s ease; }
        #theme-toggle .icon { width:20px; height:20px; fill:var(--text-color-secondary); transition: fill 0.18s ease; }
        #theme-toggle:focus { outline:none; box-shadow: 0 0 0 3px rgba(47,123,255,0.12); }
        #theme-toggle:hover { background: var(--btn-gradient); box-shadow: 0 12px 40px rgba(36,70,255,0.12); transform: translateY(-2px); }
        #theme-toggle:hover .icon { fill: #ffffff; }
        .icon-sun{display:none}.icon-moon{display:block}body.light-mode .icon-sun{display:block}body.light-mode .icon-moon{display:none}

        @media (max-width: 768px) {
            .dashboard-container { padding: 1rem; }
            .headings { flex-direction: column; align-items: stretch; }
            .header-actions { justify-content: space-between; width: 100%; }
            .table-container { border: none; background-color: transparent; }
            table { border: none; }
            table thead { display: table-header-group; } /* keep header visible on mobile too */
            table, tbody, tr { display: block; width: 100%; }
            tr { border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 1rem; background-color: var(--panel-bg); }
            td { display: flex; justify-content: space-between; align-items: center; text-align: right; padding: 0.75rem 1rem; border-bottom: 1px solid var(--border-color); white-space: normal; word-break: break-all; }
            tr td:last-child { border-bottom: none; }
            td::before { content: attr(data-label); font-weight: 500; text-align: left; margin-right: 1rem; color: var(--text-color-secondary); }
            #signsRequestedTable td:nth-of-type(1)::before { content: "File Hash"; }
            #signsRequestedTable td:nth-of-type(2)::before { content: "Signer"; }
            #signsRequestedTable td:nth-of-type(3)::before { content: "Title"; }
            #signsRequestedTable td:nth-of-type(4)::before { content: "Remind"; }
            #signsRequestedTable td:nth-of-type(5)::before { content: "Preview"; }
            #signRequestsTable td:nth-of-type(1)::before { content: "File Hash"; }
            #signRequestsTable td:nth-of-type(2)::before { content: "Title"; }
            #signRequestsTable td:nth-of-type(3)::before { content: "Requester"; }
            #signRequestsTable td:nth-of-type(4)::before { content: "Sign"; }
            #signRequestsTable td:nth-of-type(5)::before { content: "Preview"; }
            #signedByMeTable td:nth-of-type(1)::before { content: "File Hash"; }
            #signedByMeTable td:nth-of-type(2)::before { content: "Original Hash"; }
            #signedByMeTable td:nth-of-type(3)::before { content: "Title"; }
            #signedByMeTable td:nth-of-type(4)::before { content: "Requester"; }
            #signedByMeTable td:nth-of-type(5)::before { content: "Preview Signed"; }
            #signedByMeTable td:nth-of-type(6)::before { content: "Preview Original"; }
            #signedTable td:nth-of-type(1)::before { content: "File Hash"; }
            #signedTable td:nth-of-type(2)::before { content: "Original Hash"; }
            #signedTable td:nth-of-type(3)::before { content: "Requester"; }
            #signedTable td:nth-of-type(4)::before { content: "Title"; }
            #signedTable td:nth-of-type(5)::before { content: "Preview Signed"; }
            #signedTable td:nth-of-type(6)::before { content: "Preview Original"; }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="headings">
            <div class="logo-title">
                <img src="/logo.png" alt="{{productname}} Logo" class="logo">
                <div class="title-group">
                    <h1>{{productname}}</h1>
                    <h2>Document Signing</h2>
                </div>
            </div>
            <div class="header-actions">
                <button id="theme-toggle" title="Toggle light/dark theme">
                    <svg class="icon icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.64 5.64c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41l1.06 1.06c.39.39 1.02.39 1.41 0s.39-1.02 0-1.41L5.64 5.64zm12.73 12.73c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41l1.06 1.06c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41l-1.06-1.06zM18.36 5.64l-1.06 1.06c-.39.39-.39 1.02 0 1.41s1.02.39 1.41 0l1.06-1.06c.39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0zM6.7 17.3c-.39.39-.39 1.02 0 1.41l1.06 1.06c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41l-1.06-1.06c-.39-.39-1.02-.39-1.41 0z"/></svg>
                    <svg class="icon icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 2c-1.82 0-3.53.5-5 1.35C7.99 5.08 10 8.3 10 12s-2.01 6.92-5 8.65C6.47 21.5 8.18 22 10 22c5.52 0 10-4.48 10-10S15.52 2 10 2z"/></svg>
                </button>
                <a href="/dashboardlogout" class="btn btn-danger">Logout</a>
            </div>
        </div>

        <div class="tab">
            <button class="tablinks" id="firstTab" onclick="openTab(event, 'SignsRequested')">Signs Requested</button>
            <button class="tablinks" onclick="openTab(event, 'SignRequests')">Sign Requests</button>
            <button class="tablinks" onclick="openTab(event, 'SignedByMe')">Signed by Me</button>
            <button class="tablinks" onclick="openTab(event, 'Signed')">Signed</button>
            <button class="tablinks" onclick="window.open('/signverifypage')">Verify Signature</button>
        </div>

        <div id="SignsRequested" class="tabcontent">
            <h2>Documents You've Sent for Signing</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr><th>File Hash</th><th>Signer</th><th>Title</th><th>Remind</th><th>Preview</th></tr>
                    </thead>
                    <tbody id="signsRequestedTable"></tbody>
                </table>
            </div>
        </div>

        <div id="SignRequests" class="tabcontent">
            <h2>Documents Awaiting Your Signature</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr><th>File Hash</th><th>Title</th><th>Requester</th><th>Sign</th><th>Preview</th></tr>
                    </thead>
                    <tbody id="signRequestsTable"></tbody>
                </table>
            </div>
        </div>

        <div id="SignedByMe" class="tabcontent">
            <h2>Documents You've Signed</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr><th>File Hash</th><th>Original Hash</th><th>Title</th><th>Requester</th><th>Preview Signed</th><th>Preview Original</th></tr>
                    </thead>
                    <tbody id="signedByMeTable"></tbody>
                </table>
            </div>
        </div>

        <div id="Signed" class="tabcontent">
            <h2>Documents Signed by Others for You</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr><th>File Hash</th><th>Original Hash</th><th>Requester</th><th>Title</th><th>Preview Signed</th><th>Preview Original</th></tr>
                    </thead>
                    <tbody id="signedTable"></tbody>
                </table>
            </div>
        </div>
        
        <button class="floating-btn" onclick="openUploadModal()" title="Upload a new document for signing">+</button>
    </div>

    <script>
        function openUploadModal() {
            window.open('/uploadpage', 'popup', 'width=600,height=600');
        }
        
        function openTab(event, tabName) {
            const tabcontent = document.querySelectorAll('.tabcontent');
            const tablinks = document.querySelectorAll('.tablinks');
            tabcontent.forEach(content => content.classList.remove('active'));
            tablinks.forEach(link => link.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        async function fetchData(endpoint, tableId) {
            const response = await fetch(endpoint);
            const data = await response.json();
            const tableBody = document.getElementById(tableId);
            tableBody.innerHTML = '';

            data.forEach(item => {
                const row = document.createElement('tr');
                const cellOrder = {
                    'signsRequestedTable': ['hash', 'signer', 'title'],
                    'signRequestsTable': ['hash', 'title', 'requester'],
                    'signedByMeTable': ['hash', 'originalHash', 'title', 'requester'],
                    'signedTable': ['hash', 'originalHash', 'requester', 'title']
                }[tableId];

                cellOrder.forEach(key => {
                    const cell = document.createElement('td');
                    cell.textContent = item[key];
                    row.appendChild(cell);
                });

                const hash = item.hash;
                const originalHash = item.originalHash;
                const signer = item.signer;
                
                if (tableId === 'signsRequestedTable') {
                    row.innerHTML += `<td><button class="btn" onclick="remind('${signer}', '${hash}')">Remind</button></td>`;
                    row.innerHTML += `<td><button class="btn" onclick="download('${hash}')">Preview</button></td>`;
                } else if (tableId === 'signRequestsTable') {
                    row.innerHTML += `<td><button class="btn" onclick="sign('${hash}')">Sign</button></td>`;
                    row.innerHTML += `<td><button class="btn" onclick="download('${hash}')">Preview</button></td>`;
                } else if (tableId === 'signedByMeTable' || tableId === 'signedTable') {
                    row.innerHTML += `<td><button class="btn" onclick="download('${hash}')">Preview Signed</button></td>`;
                    row.innerHTML += `<td><button class="btn" onclick="download('${originalHash}')">Preview Original</button></td>`;
                }

                tableBody.appendChild(row);
            });
        }

        function download(hash) {
            if (!hash || hash === 'undefined') {
                alert('No hash provided for download.');
                return;
            }
            window.open(`/fileviewer?hash=${hash}`, 'popup', 'width=800,height=900');
        }

        function remind(signer, hash) {
            fetch('/signremind', {
                method: 'POST',
                body: new URLSearchParams({ hash: hash, signer: signer })
            })
            .then(response => response.text())
            .then(text => alert(text))
            .catch(error => console.error('Error:', error));
        }

        function sign(hash) {
            alert('Approve request from {{productname}} app');
            fetch('/sign', {
                method: 'POST',
                body: new URLSearchParams({ filehash: hash })
            })
            .then(response => response.text())
            .then(text => {
                alert(text);
                document.getElementById('firstTab').click();
            })
            .catch(error => console.error('Error:', error));
        }

        document.querySelectorAll('.tablinks').forEach(button => {
            button.addEventListener('click', (e) => {
                if (e.target.textContent === 'Verify Signature') return;
                const endpointMap = {
                    'Signs Requested': '/all_signs_requested',
                    'Sign Requests': '/all_sign_requests',
                    'Signed by Me': '/all_signed_by_me',
                    'Signed': '/all_signed'
                };
                const tableIdMap = {
                    'Signs Requested': 'signsRequestedTable',
                    'Sign Requests': 'signRequestsTable',
                    'Signed by Me': 'signedByMeTable',
                    'Signed': 'signedTable'
                };
                fetchData(endpointMap[e.target.textContent], tableIdMap[e.target.textContent]);
            });
        });

        document.getElementById('firstTab').click();
        
        const themeToggle = document.getElementById('theme-toggle');
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('light-mode');
        });
    </script>
</body>
</html>